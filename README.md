[![Build Status](https://travis-ci.org/marcellobarile/type-graphql-has.svg?branch=master)](https://travis-ci.org/marcellobarile/type-graphql-has)

**GraphQL schema and resolvers self-composition (Code-first approach)**
---
Thanks to [https://typegraphql.ml/](type-graphql) this application is capable of generating the GraphQL schema at- run-time during the bootload. The developer(s) will "only" have to create the needed entities under the "models" folder ('server/models') using specific decorators described [https://typegraphql.ml/docs/introduction.html](here).

:blush: _Tip: If you want to manually generate the GraphQL schema, just run ```npm run prepare-graphql```_

**Easily configurable**

The application does support two configuration files, both located in the root directory.
The 'serviceconfig.custom.json' is (obviously) used for custom configurations; for accessing the configurations from your TS files, there is a "Conf" class, placed under 'config/common.ts', that can be used.

:blue_book: **Special case:** How to access configurations for remotes services

_Note: The conf. helper will automatically derive the ENV to be used. You don't need to specify it._

```
// ... your code
import { getEndpoint } from '../../../config/apis';
// ... your code
const servUrl = getEndpoint('foobar-service');
// ... your code
```

**Tech. stack:**
---
1. Webpack 4 + TypeScript 3
2. Express 4 + ejs
3. Apollo Server 2
4. GraphQL 15
6. Lodash
7. Request Promise
8. PM2 ready
9. Docker ready

**Extending the GraphQL context**
---
In the GraphQL world, a context is an object (or a function) that returns an object which will be shared across all the resolvers.
Under the 'server/context' folder, there is the file that exports the custom context object where you can add the properties that your solution does need.

**Shaping and expanding the GraphQL response**
---
The GraphQL response can be re-shaped or expanded using a custom function that will return the new response.
You can find it under 'server/extensions'.

**Adding GraphQL middlewares**
---
For the Express framework, middleware functions are functions that have access to the request object (req), the response object (res), and the next middleware function in the applicationâ€™s request-response cycle. The next middleware function is commonly denoted by a variable named "next".
Our custom middleware functions can be defined in the index.ts file under 'server/middlewares'.
Please note that it is an array of functions and has to remain like this.

**Working with custom validation rules**
---
The so called "validation rules" are additional GraphQL validations that get applied to client-specified queries. You can find the array containing them under 'server/validationRules'.

For further information: (default rules already applied [https://github.com/graphql/graphql-js/tree/master/src/validation/rules](https://github.com/graphql/graphql-js/tree/master/src/validation/rules))

**About autogenerated interfaces**
---
The application exposes two endpoints to download types and interfaces (`{rest_endpoint}/types` and `{rest_endpoint}/interfaces`). These files can be consumed by a client application.

**Setup**
---
```
npm install
```

**First run after the setup**
---
If you are on production you just need to run the `npm run prod` command.

**Run Builds**
---
```
npm run build:dev
```
```
npm run build:stage
```
```
npm run build:prod
```

**Run Application locally**
---
DEV env.:
```
npm run dev
```

TRAIN env.:
```
npm run stage
```

PROD env.:
```
npm run prod
```

**GraphQL to TypeScript - autogenerate schema, types, fragments and TS interfaces**
---
```
npm run prepare-graphql
```

**Run Tests**
---
```
npm run test
```

**Prod. PM2 first run**
---
```
npm run pm2:prod:first-run
```
Remember to run `pm2 save` to dump the processes list

**Generate documentation**
---
```npm run docs``` to automatically generate documentation, ```npm run docs:clean``` to remove it
```
